<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Timelapse</title>
  <link href={{ static_url("css/bootstrap.min.css") }} rel="stylesheet">
  <script src={{ static_url("js/jquery.min.js") }}></script>
  <script src={{ static_url("js/bootstrap.min.js") }}></script>
</head>
<body class="bd-docs">
  <div class="container">
    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active"><a role="tab" data-toggle="tab" href="#tab_tl_setup"><span class="glyphicon glyphicon-time"></span></a></li>
      <li role="presentation"><a role="tab" data-toggle="tab" href="#tab_cam_setup"><span class="glyphicon glyphicon-camera"></span></a></li>
      <li role="presentation"><a role="tab"  data-toggle="tab" href="#tab_preview"><span class="glyphicon glyphicon-facetime-video"></span></a></li>
    </ul>
    <div class="tab-content">
      <!----------------------------------------------------------------------
                       T I M E L A P S E     S E T U P
      ----------------------------------------------------------------------->
      <div role="tabpanel" id="tab_tl_setup" class="tab-pane active">
        <div class="container">
          <form role="form" method="POST">
            <div class="form-group">
              <label for="input_dt">DELTA TIME (secs)</label>
              <input name="D" id="input_dt" class="form-control" type="number" value="{{D}}"/>
            </div>
            <div class="form-group">
              <label for="input_tot">NUMBER OF IMAGES</label>
              <input name="N" id="input_tot" class="form-control" type="number" value="{{N}}"/>
            </div>
          <div class="alert alert-info text-center" role="alert">TOTAL TIME = {{T}}</div>
          <button type="submit" class="btn btn-success btn-lg center-block">
            <span class="glyphicon glyphicon glyphicon-thumbs-up"></span> GO
          </button>
          </form>
        </div>
      </div>
      <!----------------------------------------------------------------------
                          C A M E R A     S E T U P
      ----------------------------------------------------------------------->
      <div role="tabpanel" id="tab_cam_setup" class="tab-pane">
        <div class="container">
        <form role="form">
        <div class="form-group">
          <label for="sel_shutter">SHUTTER SPEED</label>
          <select name='S' class="form-control" id="sel_shutter">
              <option value='0'       {{S_0}}>AUTO</option>
              <option value='2000000' {{S_1}}>2'</option>
              <option value='1000000' {{S_2}}>1'</option>
              <option value='500000'  {{S_3}}>1/2</option>
              <option value='250000'  {{S_4}}>1/4</option>
              <option value='125000'  {{S_5}}>1/8</option>
              <option value='62500'   {{S_6}}>1/16</option>
              <option value='31250'   {{S_7}}>1/32</option>
              <option value='15625'   {{S_8}}>1/64</option>
              <option value='7813'    {{S_9}}>1/128</option>
              <option value='3906'    {{S_10}}>1/256</option>
              <option value='1953'    {{S_11}}>1/512</option>
              <option value='978'     {{S_12}}>1/1024</option>
              <option value='489'     {{S_13}}>1/2048</option>
              <option value='400'     {{S_14}}>400us</option>
              <option value='350'     {{S_15}}>350us</option>
              <option value='300'     {{S_16}}>300us</option>
              <option value='250'     {{S_17}}>250us</option>
              <option value='200'     {{S_18}}>200us</option>
              <option value='150'     {{S_19}}>150us</option>
              <option value='100'     {{S_20}}>100us</option>
          </select>
          <label for="sel_shutter">ISO</label>
          <select name='I' class="form-control" id="sel_iso">
              <option value='0'   {{I_0}}>AUTO</option>
              <option value='100' {{I_1}}>100</option>
              <option value='200' {{I_2}}>200</option>
              <option value='320' {{I_3}}>320</option>
              <option value='400' {{I_4}}>400</option>
              <option value='500' {{I_5}}>500</option>
              <option value='640' {{I_6}}>640</option>
              <option value='800' {{I_7}}>800</option>
          </select>
        </div>
        </form>
        <p>
        <div class="text-center">
        <button type="button" class="btn btn-success btn-lg">
          <span class="glyphicon glyphicon-camera"></span> TAKE
        </button>
        <button type="button" class="btn btn-info btn-lg">
          <span class="glyphicon glyphicon-facetime-video"></span> LIVE
        </button>
        </div>
        </p>
        <img id="preview" class="img-responsive" src={{ static_url("test.jpg") }}/>
        </div>
      </div>
      <!----------------------------------------------------------------------
                         L I V E    P R E V I E W
      ----------------------------------------------------------------------->
      <div role="tabpanel" id="tab_preview" class="tab-pane">
        <div class="text-center">
          <div id="live_view" style="background:url("static/test.jpg"); width:640px; height:360px;">
          <object data={{ static_url("rule_of_thirds_16x9.svg") }} width=640 height=360></object>
          </div>
        </div>
        
        <!--
        <img id="live_view" class="img-responsive center-block" src={{ static_url("test.jpg") }}/>
        -->
        
        <br/><br/>
      </div>
    </div>
  </div>
<script>
  var ws = null;
   
  $('a[data-toggle="tab"]').on('hide.bs.tab', function (e) {
    if ($(e.target).attr("href") === "#tab_preview") {
      //window.alert("STOP STREAM");
      if (ws != null) {
        if (ws.readyState == WebSocket.OPEN) {
            ws.close()
            ws = null;
        }
      }
    }
  })
  
  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    if ($(e.target).attr("href") === "#tab_preview") {
      //window.alert("START STREAM");
      ws = new WebSocket("ws://"+location.host+"/camera_ws");
      ws.onmessage = function (messageEvent) {
        //live_view.src = "data:image/jpeg;base64," + messageEvent.data;
        live_view.style.backgroundImage = "data:image/jpeg;base64," + messageEvent.data;
      }
    }
  })
</script>

</body>
</html>